<html>
  <head>
    <style type="text/css">body{-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;}</style>
  </head>
  <body>
    <script type="text/javascript" src="{{ url_for('static', filename='jquery-3.5.1.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='game.js') }}"></script>
    <script type="text/javascript">
      var words = {{words|safe}};
      var puzzle = {{puzzle|safe}};
      var solution = {{solution|safe}};
      var reveal_words = {{reveal_words|safe}};
      var title = '{{title|safe}}';
    </script>
    <script type="text/javascript">
      $(document).ready(function(){
        render(words, puzzle, solution, reveal_words, 'puzzle');
      });
      $(document).ready(function(){
        $("#shuffle").click(function(){
          stopTimer();
          $("#svgPuzzle").empty();
          $("#timer").empty();
          wait = document.createElementNS("http://www.w3.org/2000/svg", "text");
          wait.setAttribute("x", "1cm");
          wait.setAttribute("y", "0cm");
          wait.setAttribute("font-size", globals.font_size + "cm");
          wait.setAttribute("dominant-baseline", "hanging");
          wait.setAttribute("text-anchor", "start");
          wait.appendChild(document.createTextNode("Wait..."));
          document.getElementById("svgPuzzle").appendChild(wait);
          $.ajax(
            {
              url: {{ request.script_root|tojson|safe }} + "/api/instant/shuffle",
              type: "POST",
              data: {
                "words": words.join(','),
                "template": puzzle.join('|'),
                "title": title
              },
              async: true,
              success: function(result){
                document.getElementById("svgPuzzle").removeChild(wait);
                words = result['words'];
                puzzle = result['puzzle'];
                solution = result['solution'];
                render(words, puzzle, solution, reveal_words, 'puzzle');
              }
            }
          );
        });
      });
    </script>
    <div id="title"><h1>{{title|safe}}</h1></div>
    <div id="puzzle"></div>
    <p id="timer"></p>
    <button id="shuffle">Shuffle</button>
    <footer>Puzzle #{{rowid|safe}}, created {{created|safe}}</footer>
  </body>
</html>
